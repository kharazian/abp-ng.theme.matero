<ng-container
  [ngTemplateOutlet]="menuListTpl"
  [ngTemplateOutletContext]="{
    menuList: routesService.visible$ | async,
    parentRoute: [],
    level: 0
  }"
>
</ng-container>

<ng-template #menuListTpl let-menuList="menuList" let-parentRoute="parentRoute" let-level="level">
  <ul
    class="crm-sidemenu level-{{ nodeLevel(menuList[0]) }}"
    [class.submenu]="!!menuList[0].parent"
  >
    <li
      *ngFor="let menuItem of menuList; trackBy: trackByFn"
      class="menu-item"
      routerLinkActive="active"
      [route]="menuItem.route"
      [type]="menuItem.name"
      #crmDropdownToggle
    >
      <ng-container *abpPermission="menuItem.requiredPolicy || ''"
        [ngTemplateOutlet]="isDropdown(menuItem) ? dropdownLink : defaultLink"
        [ngTemplateOutletContext]="{ $implicit: menuItem }"
      >
      </ng-container>
    </li>
  </ul>
</ng-template>

<ng-template #defaultLink let-menuItem>
  <a class="menu-heading" [routerLink]="[menuItem.path]" matRipple [matRippleDisabled]="!ripple">
    <ng-container
      [ngTemplateOutlet]="linkTypeTpl"
      [ngTemplateOutletContext]="{ $implicit: menuItem }"
    >
    </ng-container>
  </a>
</ng-template>

<ng-template #dropdownLink let-menuItem>
  <button class="menu-heading menu-toggle" matRipple [matRippleDisabled]="!ripple"
  (click)="dropdownExpand(menuItem)">
    <ng-container
      [ngTemplateOutlet]="linkTypeTpl"
      [ngTemplateOutletContext]="{ $implicit: menuItem }"
    >
    </ng-container>
  </button>

  <ng-container
    *ngIf="menuItem.children.length > 0"
    [ngTemplateOutlet]="menuListTpl"
    [ngTemplateOutletContext]="{
      menuList: menuItem.children,
      level: level + 1
    }"
  >
  </ng-container>
</ng-template>

<ng-template #linkTypeTpl let-menuItem>
  <i class="menu-icon" *ngIf="!menuItem.parent" [ngClass]="menuItem.iconClass"></i>
  <!-- <mat-icon class="menu-icon" *ngIf="level === 0">{{ menuItem.iconClass }}</mat-icon> -->
  <span class="menu-name">{{ menuItem.name | abpLocalization }}</span>
  <!-- <span class="menu-label bg-{{ menuItem.label.color }}" *ngIf="menuItem.label">{{
    menuItem.label.value
  }}</span>
  <span class="menu-badge bg-{{ menuItem.badge.color }}" *ngIf="menuItem.badge">{{
    menuItem.badge.value
  }}</span> -->
  <mat-icon class="menu-caret" *ngIf="!menuItem.isLeaf">
    {{ 'arrow_drop_down' }}
  </mat-icon>
</ng-template>
