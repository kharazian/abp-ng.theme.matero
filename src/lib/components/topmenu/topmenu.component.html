<nav mat-tab-nav-bar [tabPanel]="tabPanel">
  <ng-container *ngFor="let menuItem of routesService.visible$ | async; trackBy: trackByFn">
    <ng-container
      *abpPermission="menuItem.requiredPolicy || ''"
      [ngTemplateOutlet]="isDropdown(menuItem) ? dropdownLink : defaultLink"
      [ngTemplateOutletContext]="{ $implicit: menuItem }"
    >
    </ng-container>
  </ng-container>
</nav>
<mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>

<ng-template #defaultLink let-menuItem>
  <button mat-button [routerLink]="[menuItem.path]">
    <ng-container
      [ngTemplateOutlet]="linkTypeTpl"
      [ngTemplateOutletContext]="{ $implicit: menuItem }"
    >
    </ng-container>
  </button>
</ng-template>

<ng-template #dropdownLink let-menuItem>
  <button mat-button [matMenuTriggerFor]="submenu.menuPanel">
    <ng-container
      [ngTemplateOutlet]="linkTypeTpl"
      [ngTemplateOutletContext]="{ $implicit: menuItem }"
    >
    </ng-container>
    <app-topmenu-panel #submenu [items]="menuItem.children!"> </app-topmenu-panel>
  </button>
</ng-template>

<ng-template #linkTypeTpl let-menuItem>
  <i class="menu-icon" *ngIf="!menuItem.parent" [ngClass]="menuItem.iconClass"></i>
  <span class="menu-name">{{ menuItem.name | abpLocalization }}</span>
  <mat-icon class="menu-caret" *ngIf="!menuItem.isLeaf">
    {{ 'arrow_drop_down' }}
  </mat-icon>
</ng-template>
